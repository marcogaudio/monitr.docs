<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>monitr • monitr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="monitr">
<meta property="og:description" content="monitr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">monitr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/optimize_exposure.html">monitr</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="optimize_exposure_files/header-attrs-2.6/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>monitr</h1>
                        <h4 class="author">Luigi Aceto, Marco Gaudio</h4>
            
      
      
      <div class="hidden name"><code>optimize_exposure.Rmd</code></div>

    </div>

    
    
<hr>
<div id="introduction-to-monitr-" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-to-monitr-" class="anchor"></a>Introduction to monitr.</h2>
<hr>
<p>This vignette describes the usage of the package <code>monitr</code>.</p>
<p>The main goals of the package, given a dataframe of insurance policies, are:</p>
<ul>
<li><p>provide an optimize computation of the exposure for calendar year, by taking into account the birthday of policyholder;</p></li>
<li><p>compute the expected claims, given a mortality table;</p></li>
<li><p>compute the IBNR claims.</p></li>
</ul>
<p>The package <code>monitr</code> includes the following functions:</p>
<ul>
<li><p><code><a href="../reference/expand_portfolio.html">expand_portfolio()</a></code>, taking on as input a dataset with one row for each insurance policies, this function first expands it in a such a way that each policy has n rows, where n is the number of years the contract is in force, then it duplicates the rows, so that each policy has <span class="math inline">\(n * 2\)</span> rows. In this way the dataset is suited to be passed to the function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>;</p></li>
<li><p><code><a href="../reference/duplicate_portfolio.html">duplicate_portfolio()</a></code>, given a dataset with n rows for each policy, where n is the number of years the policy is in force, the function duplicate the dataset, providing a new object that is suited to the function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>;</p></li>
<li><p><code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>, given a dataset with <span class="math inline">\(n * 2\)</span> rows for each policy (where n is the number of years the policy is in force), it optimizes the computation of the exposure for each calendar year by taking into account the birthday of the policyholder;</p></li>
<li><p><code><a href="../reference/compute_expectedclaim.html">compute_expectedclaim()</a></code>, given as input a dataframe of insurance policies coming out from <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>, it returns a new dataframe with the associated expected claim for each age of the policyhoder.</p></li>
<li><p><code><a href="../reference/calculate_IBNR.html">calculate_IBNR()</a></code>, given as input a data frame of insurance policies coming out from the function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>, and a table with IBNR factors, calculate the IBNR claims.</p></li>
</ul>
</div>
<div id="the-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#the-datasets" class="anchor"></a>The datasets</h2>
<p>In the package there are 3 data frames of simulated life insurance policies, one for each possible kind of dataset structure, that is, one single row for each policy (<code>onerow_lifepolicies</code>), n rows for each policy (<code>raw_lifepolicies</code>), <span class="math inline">\(n * 2\)</span> rows for each policy (optimal form, <code>lifepolicies</code>), where n is the number of years the contract is in force. All the datasets have the same 2,500 policies and the same variables.</p>
<p>The data set <code>lifepolicies</code> is the optimal one for the usage of the package’s functions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"lifepolicies"</span><span class="op">)</span>
<span class="va">lifepolicies</span>
<span class="co">#&gt; # A tibble: 27,054 x 11</span>
<span class="co">#&gt;    Policy_id Inception_date Term_date  Birth_date Gender    UY    CY Claim_date</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2013 2099-12-31</span>
<span class="co">#&gt;  2   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  3   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  4   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  5   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt;  6   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2018 2099-12-31</span>
<span class="co">#&gt;  7   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2019 2099-12-31</span>
<span class="co">#&gt;  8   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2020 2099-12-31</span>
<span class="co">#&gt;  9   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2021 2099-12-31</span>
<span class="co">#&gt; 10   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2022 2099-12-31</span>
<span class="co">#&gt; # ... with 27,044 more rows, and 3 more variables: Claim &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Lapse_date &lt;date&gt;, Lapse &lt;dbl&gt;</span></code></pre></div>
<p>There are several variables in the data frame of simulated life insurance policies:</p>
<ul>
<li><p><code>Policy_id</code> the policy number identifier. It is unique for each policy.</p></li>
<li><p><code>Inception_date</code> the signing date of the contract.</p></li>
<li><p><code>Term_date</code> the ending date of the contract.</p></li>
<li><p><code>Birth_date</code> the date of birth of the policyholder.</p></li>
<li><p><code>Gender</code> the policyholder’s gender.</p></li>
<li><p><code>UY</code> the underwriting year.</p></li>
<li><p><code>CY</code> the current year of evaluation.</p></li>
<li><p><code>Claim_date</code> date when claim occurred, if any, otherwise 2099-12-31.</p></li>
<li><p><code>Claim</code> 1 if the year of `<code>Claim_date</code> is eqaul to <code>CY</code>, o otherwise.</p></li>
<li><p><code>Lapse_date</code> date when policy lapsed, if so, otherwise 2099-12-31.</p></li>
<li><p><code>Lapse</code> 1 if year of <code>Lapse_date</code> is equal to <code>CY</code>, 0 otherwise.</p></li>
</ul>
</div>
<div id="making-the-data-suitable-" class="section level2">
<h2 class="hasAnchor">
<a href="#making-the-data-suitable-" class="anchor"></a>Making the data suitable.</h2>
<p>In order to use the functions for the optimal computation of the exposure, the expected claim and the IBNR claim, the data frame should be transformed in a suitable format, that is, each policy in the data frame needs a number of row equal to <span class="math inline">\(n * 2\)</span>, where n is the number of years the contract is in force. This special structure of the data frame is required for computing the exposure of each policyholder, in each current year, for two different ages (before and after the anniversary date).</p>
<div id="expand_portfolio" class="section level3">
<h3 class="hasAnchor">
<a href="#expand_portfolio" class="anchor"></a><code>expand_portfolio()</code>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"onerow_lifepolicies"</span><span class="op">)</span>
<span class="va">onerow_lifepolicies</span>
<span class="co">#&gt; # A tibble: 2,500 x 10</span>
<span class="co">#&gt;    Policy_id Inception_date Term_date  Birth_date Gender    UY Claim_date Claim</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;date&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt;  1   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013 2099-12-31     0</span>
<span class="co">#&gt;  2   1005404 2014-08-01     2020-08-01 1943-03-17 M       2014 2099-12-31     0</span>
<span class="co">#&gt;  3   1009039 2014-06-01     2021-06-01 1945-11-25 F       2014 2099-12-31     0</span>
<span class="co">#&gt;  4   1009374 2015-03-01     2026-03-01 1952-04-07 F       2015 2099-12-31     0</span>
<span class="co">#&gt;  5   1018324 2012-11-01     2018-11-01 1938-06-14 M       2012 2017-11-30     1</span>
<span class="co">#&gt;  6   1019545 2013-11-01     2017-11-01 1940-11-06 M       2013 2014-01-05     1</span>
<span class="co">#&gt;  7   1020568 2016-06-01     2019-06-01 1949-08-26 F       2016 2017-09-16     1</span>
<span class="co">#&gt;  8   1020763 2015-06-01     2023-06-01 1955-03-20 F       2015 2016-03-10     1</span>
<span class="co">#&gt;  9   1036615 2015-03-01     2022-03-01 1941-03-14 M       2015 2017-05-07     1</span>
<span class="co">#&gt; 10   1044618 2013-08-01     2017-08-01 1955-10-09 M       2013 2014-03-14     1</span>
<span class="co">#&gt; # ... with 2,490 more rows, and 2 more variables: Lapse_date &lt;date&gt;,</span>
<span class="co">#&gt; #   Lapse &lt;dbl&gt;</span></code></pre></div>
<p>As shown by the tibble above, the data frame <code>onerow_lifepolicies</code> has one single row for each policy. In order to overcome this problem, the function <code><a href="../reference/expand_portfolio.html">expand_portfolio()</a></code> can be used. The function expand the dataset, in order to make it suitable(<span class="math inline">\(n * 2\)</span> rows for each policy) for the other functions in the package <code>monitr</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">onerow_lifepolicies</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/expand_portfolio.html">expand_portfolio</a></span><span class="op">(</span>.polnr <span class="op">=</span> <span class="va">Policy_id</span>, .claim <span class="op">=</span> <span class="va">Claim</span>, .claimdate <span class="op">=</span> <span class="va">Claim_date</span>,
                   .inceptiondate <span class="op">=</span> <span class="va">Inception_date</span>, .termdate <span class="op">=</span> <span class="va">Term_date</span>,
                   .lapse <span class="op">=</span> <span class="va">Lapse</span>, .lapsedate <span class="op">=</span> <span class="va">Lapse_date</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 27,054 x 11</span>
<span class="co">#&gt;    Policy_id Inception_date Term_date  Birth_date Gender    UY    CY Claim_date</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2013 2099-12-31</span>
<span class="co">#&gt;  2   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  3   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  4   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  5   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt;  6   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2018 2099-12-31</span>
<span class="co">#&gt;  7   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2019 2099-12-31</span>
<span class="co">#&gt;  8   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2020 2099-12-31</span>
<span class="co">#&gt;  9   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2021 2099-12-31</span>
<span class="co">#&gt; 10   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2022 2099-12-31</span>
<span class="co">#&gt; # ... with 27,044 more rows, and 3 more variables: Claim &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Lapse_date &lt;date&gt;, Lapse &lt;dbl&gt;</span></code></pre></div>
<ul>
<li><p>The first argument to be passed is <code>.data</code>, the data frame with the life insurance policies.</p></li>
<li><p>The argument <code>.polnr</code> is for the dataset’s column with the identification number for each policy.</p></li>
<li><p><code>.claim</code> requires a column of the dataset with 1 if the claim occurred for the corresponding policy in the current year of evaluation and 0 otherwise.</p></li>
<li><p><code>.claimdate</code> requires a column of the data frame with the associated date of when the claim occurred (if not claim occurred, then it is set to 2099-31-12).</p></li>
<li><p><code>.inceptiondate</code> takes on the column’s name of the data frame with the starting date of each contract.</p></li>
<li><p><code>.termdate</code> requires the column of the data frame with the expiry date of the policies.</p></li>
<li><p><code>.lapse</code> requires a column of the dataset with 1 if the lapse occurred for the corresponding policy in the current year of evaluation and 0 otherwise.</p></li>
<li><p><code>.lapsedate</code> requires a column of the data frame with the associated date of when the policy lapsed (if policy did not lapse, then it is set to 2099-31-12).</p></li>
</ul>
<p>After having used the function <code><a href="../reference/expand_portfolio.html">expand_portfolio()</a></code>, the resulting dataset of insurance policies can be used as input in the function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>.</p>
</div>
<div id="duplicate_portfolio" class="section level3">
<h3 class="hasAnchor">
<a href="#duplicate_portfolio" class="anchor"></a><code>duplicate_portfolio()</code>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"raw_lifepolicies"</span><span class="op">)</span>
<span class="va">raw_lifepolicies</span>
<span class="co">#&gt; # A tibble: 13,527 x 11</span>
<span class="co">#&gt;    Policy_id Inception_date Term_date  Birth_date Gender    UY    CY Claim_date</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2013 2099-12-31</span>
<span class="co">#&gt;  2   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  3   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  4   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  5   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt;  6   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2018 2099-12-31</span>
<span class="co">#&gt;  7   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2019 2099-12-31</span>
<span class="co">#&gt;  8   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2020 2099-12-31</span>
<span class="co">#&gt;  9   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2021 2099-12-31</span>
<span class="co">#&gt; 10   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2022 2099-12-31</span>
<span class="co">#&gt; # ... with 13,517 more rows, and 3 more variables: Claim &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Lapse_date &lt;date&gt;, Lapse &lt;dbl&gt;</span></code></pre></div>
<p>The above dataset (<code>raw_lifepolicies</code>) shows a number of rows for each policy that is equal to <span class="math inline">\(n\)</span>. To make the data frame suitable for the function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code> it is needed to use the function <code><a href="../reference/duplicate_portfolio.html">duplicate_portfolio()</a></code>, which just duplicates each row of the data frame, such that the resulting data frame has <span class="math inline">\(n * 2\)</span> rows for each policy.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">raw_lifepolicies</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/duplicate_portfolio.html">duplicate_portfolio</a></span><span class="op">(</span>.polnr <span class="op">=</span> <span class="va">Policy_id</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 27,054 x 11</span>
<span class="co">#&gt;    Policy_id Inception_date Term_date  Birth_date Gender    UY    CY Claim_date</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;int&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2013 2099-12-31</span>
<span class="co">#&gt;  2   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  3   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  4   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  5   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt;  6   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2018 2099-12-31</span>
<span class="co">#&gt;  7   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2019 2099-12-31</span>
<span class="co">#&gt;  8   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2020 2099-12-31</span>
<span class="co">#&gt;  9   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2021 2099-12-31</span>
<span class="co">#&gt; 10   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2022 2099-12-31</span>
<span class="co">#&gt; # ... with 27,044 more rows, and 3 more variables: Claim &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Lapse_date &lt;date&gt;, Lapse &lt;dbl&gt;</span></code></pre></div>
</div>
</div>
<div id="optimize_exposure" class="section level2">
<h2 class="hasAnchor">
<a href="#optimize_exposure" class="anchor"></a><code>optimize_exposure()</code>
</h2>
<p>The function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code> is the core component of the package <code>monitr</code>.</p>
<p>The idea behind this function is to compute in an optimal way the exposure period for each policyhoder and for each year in which the contract is in force, by distinguishing each calendar year in <strong>before</strong> and <strong>after</strong> his/her birthday. Doing so, for a given policyholder and for each year we get the exposure he/she is exposed with age <span class="math inline">\(x\)</span> and the exposure he/she is exposed at age <span class="math inline">\(x + 1\)</span>.</p>
<p><span class="math inline">\(Exposure = \frac{n°\ days\ exposed\  aged\  x}{total\ n°\ days\ in\ the\ CY} \in [0,1]\)</span></p>
<p>The function takes on as input the following arguments:</p>
<ul>
<li><p><code>.data</code> requires a data frame of insurance policies as specified in the previous section (each policy with <span class="math inline">\(n * 2\)</span> rows, where <span class="math inline">\(n\)</span> is the number of year the contract is in force). For simplicityt here is used the dataset already suited, but if this is not the case, in order to prepare the data the function <code><a href="../reference/expand_portfolio.html">expand_portfolio()</a></code> or <code>duplicate_portfolio</code> must be use.</p></li>
<li><p>The argument <code>.polnr</code> is for the dataset’s column with the identification number for each policy.</p></li>
<li><p><code>.inceptiondate</code> takes on the column’s name of the data frame with the starting date of each contract.</p></li>
<li><p><code>.termdate</code> requires the column of the data frame with the expiry date of the policies.</p></li>
<li><p><code>.claimdate</code> requires a column of the data frame with the associated date of when the claim occurred (if not claim occurred, then it is set to 2099-31-12).</p></li>
<li><p><code>.lapsedate</code> requires a column of the data frame with the associated date of when the policy lapsed (if policy did not lapse, then it is set to 2099-31-12).</p></li>
<li><p><code>.birthdate</code> takes on a column of <code>.data</code> with the birthday date of the policyholders.</p></li>
<li><p><code>.gender</code> requires a column of <code>.data</code> with the gender of the policyholders.</p></li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lifepolicies</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="../reference/optimize_exposure.html">optimize_exposure</a></span><span class="op">(</span>.polnr <span class="op">=</span> <span class="va">Policy_id</span>, .inceptiondate <span class="op">=</span> <span class="va">Inception_date</span>,
                    .termdate <span class="op">=</span> <span class="va">Term_date</span>, .claimdate <span class="op">=</span> <span class="va">Claim_date</span>,
                    .lapsedate <span class="op">=</span> <span class="va">Lapse_date</span>, .birthdate <span class="op">=</span> <span class="va">Birth_date</span>,
                    .gender <span class="op">=</span> <span class="va">Gender</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 25,595 x 34</span>
<span class="co">#&gt;    Policy_id Inception_date Term_date  Birth_date Gender    UY    CY Claim_date</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2013 2099-12-31</span>
<span class="co">#&gt;  2   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  3   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  4   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  5   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  6   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  7   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  8   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt;  9   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt; 10   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2018 2099-12-31</span>
<span class="co">#&gt; # ... with 25,585 more rows, and 26 more variables: Claim &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Lapse_date &lt;date&gt;, Lapse &lt;dbl&gt;, gender &lt;chr&gt;, inception &lt;date&gt;,</span>
<span class="co">#&gt; #   year_claim &lt;dbl&gt;, year_lapse &lt;dbl&gt;, id_row &lt;int&gt;, policy_duration &lt;dbl&gt;,</span>
<span class="co">#&gt; #   claims &lt;dbl&gt;, lapses &lt;dbl&gt;, renewal_date &lt;date&gt;, valuation_date &lt;date&gt;,</span>
<span class="co">#&gt; #   inception_year &lt;date&gt;, end_year &lt;date&gt;, inception_valuation_date &lt;date&gt;,</span>
<span class="co">#&gt; #   end_valuation_date &lt;date&gt;, anniversary_date &lt;date&gt;, AGE0 &lt;dbl&gt;, AGE1 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   DAY_AGE0 &lt;dbl&gt;, DAY_AGE1 &lt;dbl&gt;, EXPOSURE_YEAR_AGE0 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPOSURE_YEAR_AGE1 &lt;dbl&gt;, EXPOSURE_IN_YEAR &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPOSURE_IN_YEAR_LAPSE &lt;dbl&gt;</span></code></pre></div>
<p><small> <strong>NOTE</strong>: <em>to see the output of the function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>, please use the arrow to slide the columns of the resulting dataset.</em> </small></p>
<p>The resulting dataset has a number of new useful columns:</p>
<ul>
<li><p><code>inception_valuation_date</code> indicates the date from which to start to compute the exposure, it can be the inception date, the renewal date or the first of January of the current year;</p></li>
<li><p><code>end_valuation_date</code> indicates the ending date to take into account in the computation of the exposure, it can be the last day of the current year, the claim/lapse date or the renewal date (this because in the following row the inception_valuation_date will be the same);</p></li>
<li><p><code>AGE0</code> is the age of the policyholder at the inception valuation date;</p></li>
<li><p><code>AGE1</code> is the possible age of the policyholder at the end valuation date;</p></li>
<li><p><code>DAY_AGE0</code> indicates the days of exposure of the policyholder with AGE0 (before his/her anniversary) in the valuation period;</p></li>
<li><p><code>DAY_AGE1</code> indicates the days of exposure of the policyholder with AGE1 (after his/her anniversary) in the valuation period;</p></li>
<li><p><code>EXPOSURE_YEAR_AGE0</code> is the exposure of the policyholder in the current year when he/she has AGE0, (it is computed as number days exposed with age0 / total number of days in the current year);</p></li>
<li><p><code>EXPOSURE_YEAR_AGE1</code> is the exposure of the policyholder in the current year when he/she has AGE1, (it is computed as number days exposed with age1 / total number of days in the current year);</p></li>
<li><p><code>EXPOSURE_IN_YEAR</code> is the total exposure in the valuation period, the sum of the previous two exposures, it is 1 by definition when a claim occurs;</p></li>
<li><p><code>EXPOSURE_IN_YEAR_lapse</code> is the total exposure in the valuation period, the sum of the previous two exposures, it is 1 by definition when a policy lapses.</p></li>
</ul>
</div>
<div id="compute_expectedclaim" class="section level2">
<h2 class="hasAnchor">
<a href="#compute_expectedclaim" class="anchor"></a><code>compute_expectedclaim()</code>
</h2>
<p>This function has been thought to be used in combination with the function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>. Indeed, it uses the output dataset provided by the latter function to compute the expected claim associated with each policyholder.</p>
<p>The arguments of this functions are:</p>
<ul>
<li><p><code>.data</code>, A data frame in the format provided by the function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>;</p></li>
<li><p><code>.table</code> requires a mortality table with at least the two columns specified below;</p></li>
<li><p><code>.age</code> takes on the <code>.table</code>’s column with the age associated to each qx;</p></li>
<li><p><code>.gender</code> requires a column of <code>.table</code> with the gender associated with each qx;</p></li>
<li><p><code>.qx</code> the <code>,.table</code>’s column with the probabilities qx (note that it has to be per 1000).</p></li>
</ul>
<p>The package <code>monitr</code> is equiped with a sample mortality table, <code>SI2006</code>, shown below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"SI2006"</span><span class="op">)</span>
<span class="va">SI2006</span>
<span class="co">#&gt; # A tibble: 240 x 3</span>
<span class="co">#&gt;      AGE GENDER    qx</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt;  1     0 M      3.98 </span>
<span class="co">#&gt;  2     0 F      3.32 </span>
<span class="co">#&gt;  3     1 M      0.270</span>
<span class="co">#&gt;  4     1 F      0.199</span>
<span class="co">#&gt;  5     2 M      0.197</span>
<span class="co">#&gt;  6     2 F      0.155</span>
<span class="co">#&gt;  7     3 M      0.151</span>
<span class="co">#&gt;  8     3 F      0.126</span>
<span class="co">#&gt;  9     4 M      0.123</span>
<span class="co">#&gt; 10     4 F      0.107</span>
<span class="co">#&gt; # ... with 230 more rows</span></code></pre></div>
<p>Below is reported a an example of application of the function <code><a href="../reference/compute_expectedclaim.html">compute_expectedclaim()</a></code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">lifepolicies</span> <span class="op">%&gt;%</span> 
   <span class="fu"><a href="../reference/optimize_exposure.html">optimize_exposure</a></span><span class="op">(</span>.polnr <span class="op">=</span> <span class="va">Policy_id</span>, .inceptiondate <span class="op">=</span> <span class="va">Inception_date</span>,
                    .termdate <span class="op">=</span> <span class="va">Term_date</span>, .claimdate <span class="op">=</span> <span class="va">Claim_date</span>,
                    .lapsedate <span class="op">=</span> <span class="va">Lapse_date</span>, .birthdate <span class="op">=</span> <span class="va">Birth_date</span>,
                    .gender <span class="op">=</span> <span class="va">Gender</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/compute_expectedclaim.html">compute_expectedclaim</a></span><span class="op">(</span>.table <span class="op">=</span> <span class="va">SI2006</span>, .age <span class="op">=</span> <span class="va">AGE</span>, .gender <span class="op">=</span> <span class="va">GENDER</span>,
                        .qx <span class="op">=</span> <span class="va">qx</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 25,595 x 38</span>
<span class="co">#&gt;    Policy_id Inception_date Term_date  Birth_date Gender    UY    CY Claim_date</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2013 2099-12-31</span>
<span class="co">#&gt;  2   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  3   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  4   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  5   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  6   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  7   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  8   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt;  9   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt; 10   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2018 2099-12-31</span>
<span class="co">#&gt; # ... with 25,585 more rows, and 30 more variables: Claim &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Lapse_date &lt;date&gt;, Lapse &lt;dbl&gt;, gender &lt;chr&gt;, inception &lt;date&gt;,</span>
<span class="co">#&gt; #   year_claim &lt;dbl&gt;, year_lapse &lt;dbl&gt;, id_row &lt;int&gt;, policy_duration &lt;dbl&gt;,</span>
<span class="co">#&gt; #   claims &lt;dbl&gt;, lapses &lt;dbl&gt;, renewal_date &lt;date&gt;, valuation_date &lt;date&gt;,</span>
<span class="co">#&gt; #   inception_year &lt;date&gt;, end_year &lt;date&gt;, inception_valuation_date &lt;date&gt;,</span>
<span class="co">#&gt; #   end_valuation_date &lt;date&gt;, anniversary_date &lt;date&gt;, AGE0 &lt;dbl&gt;, AGE1 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   DAY_AGE0 &lt;dbl&gt;, DAY_AGE1 &lt;dbl&gt;, EXPOSURE_YEAR_AGE0 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPOSURE_YEAR_AGE1 &lt;dbl&gt;, EXPOSURE_IN_YEAR &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPOSURE_IN_YEAR_LAPSE &lt;dbl&gt;, qx.x &lt;dbl&gt;, qx.y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPECTED_CLAIM_AGE0 &lt;dbl&gt;, EXPECTED_CLAIM_AGE1 &lt;dbl&gt;</span></code></pre></div>
<p><small> <strong>NOTE</strong>: <em>to see the output of the function <code><a href="../reference/compute_expectedclaim.html">compute_expectedclaim()</a></code>, please use the arrow to slide the columns of the resulting dataset.</em> </small></p>
<p>The function provides a new data frame as output, with the following columns (in addition to those created by <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>):</p>
<ul>
<li><p><code>qx.x</code> indicates the probability of dying between AGE0 and AGE1 for the policyholder;</p></li>
<li><p><code>qx.y</code> .y indicates the probaability of dying between AGE1 and AGE1+ 1 for the policyolder;</p></li>
<li><p><code>EXPECTED_CLAIM_AGE0</code> is the expected claim for the policyholder at AGE0, computed as: <span class="math inline">\(exposure\ in\ year\ when\ he/she\ has\ AGE0 * ( \frac{qx.x} {1000})\)</span></p></li>
<li><p><code>EXPECTED_CLAIM_AGE1</code> is the expected claim for the policyholder at AGE1, computed as: <span class="math inline">\(exposure\ in\ year\ when\ he/she\ has\ AGE1 * ( \frac{qx.y} {1000})\)</span></p></li>
</ul>
</div>
<div id="calculate_ibnr" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate_ibnr" class="anchor"></a><code>calculate_IBNR()</code>
</h2>
<p>This last function uses as input a data frame came out from the function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code> and a table with IBNR (Incurred but not reported) factors associated with the corresponding year, in order to compute a column for the IBNR claims.</p>
<p>In <code>monitr</code> an example of table with IBNR factors is provided by <code>IBNR_factors_CQP</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"IBNR_factors_CQP"</span><span class="op">)</span>
<span class="va">IBNR_factors_CQP</span>
<span class="co">#&gt;     CY IBNR_factor</span>
<span class="co">#&gt; 1 2019        2.10</span>
<span class="co">#&gt; 2 2018        1.10</span>
<span class="co">#&gt; 3 2017        1.04</span>
<span class="co">#&gt; 4 2016        1.02</span>
<span class="co">#&gt; 5 2015        1.01</span>
<span class="co">#&gt; 6 2014        1.00</span>
<span class="co">#&gt; 7 2013        1.00</span>
<span class="co">#&gt; 8 2012        1.00</span></code></pre></div>
<p>The arguments required by the function <code><a href="../reference/calculate_IBNR.html">calculate_IBNR()</a></code> are:</p>
<ul>
<li><p><code>.data</code> a data frame came out from the function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>.</p></li>
<li><p><code>.ibnrtable</code> a table with two columns, one for the IBNR factors and one for the associated calendar year.</p></li>
<li><p><code>.ibnrfactor</code> the column of <code>.ibnrtable</code> with the ibnr factors.</p></li>
<li><p><code>.cy</code> the column of <code>ibnrtable</code> with the corresponding calendar year of the IBNR factors.</p></li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">lifepolicies</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/optimize_exposure.html">optimize_exposure</a></span><span class="op">(</span>.polnr <span class="op">=</span> <span class="va">Policy_id</span>, .inceptiondate <span class="op">=</span> <span class="va">Inception_date</span>,
                    .termdate <span class="op">=</span> <span class="va">Term_date</span>, .claimdate <span class="op">=</span> <span class="va">Claim_date</span>,
                    .lapsedate <span class="op">=</span> <span class="va">Lapse_date</span>, .birthdate <span class="op">=</span> <span class="va">Birth_date</span>,
                    .gender <span class="op">=</span> <span class="va">Gender</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/compute_expectedclaim.html">compute_expectedclaim</a></span><span class="op">(</span>.table <span class="op">=</span> <span class="va">SI2006</span>, .age <span class="op">=</span> <span class="va">AGE</span>,
                        .gender <span class="op">=</span> <span class="va">GENDER</span>, .qx <span class="op">=</span> <span class="va">qx</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/calculate_IBNR.html">calculate_IBNR</a></span><span class="op">(</span>.ibnrtable <span class="op">=</span> <span class="va">IBNR_factors_CQP</span>,
                 .ibnrfactor <span class="op">=</span> <span class="va">IBNR_factor</span>, .cy <span class="op">=</span> <span class="va">CY</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 25,595 x 40</span>
<span class="co">#&gt;    Policy_id Inception_date Term_date  Birth_date Gender    UY    CY Claim_date</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2013 2099-12-31</span>
<span class="co">#&gt;  2   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  3   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  4   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  5   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  6   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  7   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  8   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt;  9   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt; 10   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2018 2099-12-31</span>
<span class="co">#&gt; # ... with 25,585 more rows, and 32 more variables: Claim &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Lapse_date &lt;date&gt;, Lapse &lt;dbl&gt;, gender &lt;chr&gt;, inception &lt;date&gt;,</span>
<span class="co">#&gt; #   year_claim &lt;dbl&gt;, year_lapse &lt;dbl&gt;, id_row &lt;int&gt;, policy_duration &lt;dbl&gt;,</span>
<span class="co">#&gt; #   claims &lt;dbl&gt;, lapses &lt;dbl&gt;, renewal_date &lt;date&gt;, valuation_date &lt;date&gt;,</span>
<span class="co">#&gt; #   inception_year &lt;date&gt;, end_year &lt;date&gt;, inception_valuation_date &lt;date&gt;,</span>
<span class="co">#&gt; #   end_valuation_date &lt;date&gt;, anniversary_date &lt;date&gt;, AGE0 &lt;dbl&gt;, AGE1 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   DAY_AGE0 &lt;dbl&gt;, DAY_AGE1 &lt;dbl&gt;, EXPOSURE_YEAR_AGE0 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPOSURE_YEAR_AGE1 &lt;dbl&gt;, EXPOSURE_IN_YEAR &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPOSURE_IN_YEAR_LAPSE &lt;dbl&gt;, qx.x &lt;dbl&gt;, qx.y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPECTED_CLAIM_AGE0 &lt;dbl&gt;, EXPECTED_CLAIM_AGE1 &lt;dbl&gt;, IBNR_factor &lt;dbl&gt;,</span>
<span class="co">#&gt; #   CLAIMS_IBNR &lt;dbl&gt;</span></code></pre></div>
<p><small> <strong>NOTE</strong>: <em>to see the output of the function <code><a href="../reference/calculate_IBNR.html">calculate_IBNR()</a></code>, please use the arrow to slide the columns of the resulting dataset.</em> </small></p>
<p>The resulting data frame has two new columns:</p>
<ul>
<li><p><code>IBNR_factor</code> indicates the IBNR factor of the corresponding current year:</p></li>
<li><p><code>CLAIMS_IBNR</code> shows the associated IBNR claim for each CY and policyholder (NOTE: if the current year in the original data frame is higher than the most recent current year in the IBNR table, this will produce an NA).</p></li>
</ul>
<p>Note that the function <code><a href="../reference/calculate_IBNR.html">calculate_IBNR()</a></code> is independent from the function <code><a href="../reference/compute_expectedclaim.html">compute_expectedclaim()</a></code>. It can be used right after the function <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code> as following:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lifepolicies</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/optimize_exposure.html">optimize_exposure</a></span><span class="op">(</span>.polnr <span class="op">=</span> <span class="va">Policy_id</span>, .inceptiondate <span class="op">=</span> <span class="va">Inception_date</span>,
                    .termdate <span class="op">=</span> <span class="va">Term_date</span>, .claimdate <span class="op">=</span> <span class="va">Claim_date</span>,
                    .lapsedate <span class="op">=</span> <span class="va">Lapse_date</span>, .birthdate <span class="op">=</span> <span class="va">Birth_date</span>,
                    .gender <span class="op">=</span> <span class="va">Gender</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/calculate_IBNR.html">calculate_IBNR</a></span><span class="op">(</span>.ibnrtable <span class="op">=</span> <span class="va">IBNR_factors_CQP</span>,
                 .ibnrfactor <span class="op">=</span> <span class="va">IBNR_factor</span>, .cy <span class="op">=</span> <span class="va">CY</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 25,595 x 36</span>
<span class="co">#&gt;    Policy_id Inception_date Term_date  Birth_date Gender    UY    CY Claim_date</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2013 2099-12-31</span>
<span class="co">#&gt;  2   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  3   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  4   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  5   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  6   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  7   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  8   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt;  9   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt; 10   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2018 2099-12-31</span>
<span class="co">#&gt; # ... with 25,585 more rows, and 28 more variables: Claim &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Lapse_date &lt;date&gt;, Lapse &lt;dbl&gt;, gender &lt;chr&gt;, inception &lt;date&gt;,</span>
<span class="co">#&gt; #   year_claim &lt;dbl&gt;, year_lapse &lt;dbl&gt;, id_row &lt;int&gt;, policy_duration &lt;dbl&gt;,</span>
<span class="co">#&gt; #   claims &lt;dbl&gt;, lapses &lt;dbl&gt;, renewal_date &lt;date&gt;, valuation_date &lt;date&gt;,</span>
<span class="co">#&gt; #   inception_year &lt;date&gt;, end_year &lt;date&gt;, inception_valuation_date &lt;date&gt;,</span>
<span class="co">#&gt; #   end_valuation_date &lt;date&gt;, anniversary_date &lt;date&gt;, AGE0 &lt;dbl&gt;, AGE1 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   DAY_AGE0 &lt;dbl&gt;, DAY_AGE1 &lt;dbl&gt;, EXPOSURE_YEAR_AGE0 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPOSURE_YEAR_AGE1 &lt;dbl&gt;, EXPOSURE_IN_YEAR &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPOSURE_IN_YEAR_LAPSE &lt;dbl&gt;, IBNR_factor &lt;dbl&gt;, CLAIMS_IBNR &lt;dbl&gt;</span></code></pre></div>
<p>The functions can be used with the pipe operator even in the case of a data frame of life insurance policies not suited to be passed to <code><a href="../reference/optimize_exposure.html">optimize_exposure()</a></code>. In this case, the first operation to perform would be <code><a href="../reference/duplicate_portfolio.html">duplicate_portfolio()</a></code> or <code><a href="../reference/expand_portfolio.html">expand_portfolio()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">onerow_lifepolicies</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/expand_portfolio.html">expand_portfolio</a></span><span class="op">(</span>.polnr <span class="op">=</span> <span class="va">Policy_id</span>, .claim <span class="op">=</span> <span class="va">Claim</span>, .claimdate <span class="op">=</span> <span class="va">Claim_date</span>,
                   .inceptiondate <span class="op">=</span> <span class="va">Inception_date</span>, .termdate <span class="op">=</span> <span class="va">Term_date</span>,
                   .lapse <span class="op">=</span> <span class="va">Lapse</span>, .lapsedate <span class="op">=</span> <span class="va">Lapse_date</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/optimize_exposure.html">optimize_exposure</a></span><span class="op">(</span>.polnr <span class="op">=</span> <span class="va">Policy_id</span>, .inceptiondate <span class="op">=</span> <span class="va">Inception_date</span>,
                    .termdate <span class="op">=</span> <span class="va">Term_date</span>, .claimdate <span class="op">=</span> <span class="va">Claim_date</span>,
                    .lapsedate <span class="op">=</span> <span class="va">Lapse_date</span>, .birthdate <span class="op">=</span> <span class="va">Birth_date</span>,
                    .gender <span class="op">=</span> <span class="va">Gender</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/compute_expectedclaim.html">compute_expectedclaim</a></span><span class="op">(</span>.table <span class="op">=</span> <span class="va">SI2006</span>, .age <span class="op">=</span> <span class="va">AGE</span>,
                        .gender <span class="op">=</span> <span class="va">GENDER</span>, .qx <span class="op">=</span> <span class="va">qx</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/calculate_IBNR.html">calculate_IBNR</a></span><span class="op">(</span>.ibnrtable <span class="op">=</span> <span class="va">IBNR_factors_CQP</span>,
                 .ibnrfactor <span class="op">=</span> <span class="va">IBNR_factor</span>, .cy <span class="op">=</span> <span class="va">CY</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 25,595 x 40</span>
<span class="co">#&gt;    Policy_id Inception_date Term_date  Birth_date Gender    UY    CY Claim_date</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;date&gt;         &lt;date&gt;     &lt;date&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;date&gt;    </span>
<span class="co">#&gt;  1   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2013 2099-12-31</span>
<span class="co">#&gt;  2   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  3   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2014 2099-12-31</span>
<span class="co">#&gt;  4   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  5   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2015 2099-12-31</span>
<span class="co">#&gt;  6   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  7   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2016 2099-12-31</span>
<span class="co">#&gt;  8   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt;  9   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2017 2099-12-31</span>
<span class="co">#&gt; 10   1000503 2013-05-01     2022-05-01 1943-01-15 M       2013  2018 2099-12-31</span>
<span class="co">#&gt; # ... with 25,585 more rows, and 32 more variables: Claim &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Lapse_date &lt;date&gt;, Lapse &lt;dbl&gt;, gender &lt;chr&gt;, inception &lt;date&gt;,</span>
<span class="co">#&gt; #   year_claim &lt;dbl&gt;, year_lapse &lt;dbl&gt;, id_row &lt;int&gt;, policy_duration &lt;dbl&gt;,</span>
<span class="co">#&gt; #   claims &lt;dbl&gt;, lapses &lt;dbl&gt;, renewal_date &lt;date&gt;, valuation_date &lt;date&gt;,</span>
<span class="co">#&gt; #   inception_year &lt;date&gt;, end_year &lt;date&gt;, inception_valuation_date &lt;date&gt;,</span>
<span class="co">#&gt; #   end_valuation_date &lt;date&gt;, anniversary_date &lt;date&gt;, AGE0 &lt;dbl&gt;, AGE1 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   DAY_AGE0 &lt;dbl&gt;, DAY_AGE1 &lt;dbl&gt;, EXPOSURE_YEAR_AGE0 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPOSURE_YEAR_AGE1 &lt;dbl&gt;, EXPOSURE_IN_YEAR &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPOSURE_IN_YEAR_LAPSE &lt;dbl&gt;, qx.x &lt;dbl&gt;, qx.y &lt;dbl&gt;,</span>
<span class="co">#&gt; #   EXPECTED_CLAIM_AGE0 &lt;dbl&gt;, EXPECTED_CLAIM_AGE1 &lt;dbl&gt;, IBNR_factor &lt;dbl&gt;,</span>
<span class="co">#&gt; #   CLAIMS_IBNR &lt;dbl&gt;</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Aceto Luigi, Gaudio Marco.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
